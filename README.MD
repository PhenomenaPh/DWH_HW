# Система бронирования авиабилетов с репликацией PostgreSQL

Этот проект представляет собой систему бронирования авиабилетов, использующую PostgreSQL с настроенной репликацией, работающую в Docker.

## Структура проекта

- `docker-compose.yml`: Конфигурация Docker Compose для запуска первичного и реплицируемого экземпляров PostgreSQL.
- `init.sql`: SQL-скрипт для инициализации репликации.
- `schema.sql`: SQL-скрипт для создания структуры базы данных.
- `insert_sample_data.sql`: SQL-скрипт для вставки примерных данных.
- `create_views.sql`: SQL-скрипт для создания представления статистики аэропортов.

## Предварительные требования

- Docker
- Docker Compose

## Установка и запуск

1. Клонируйте репозиторий:
   ```
   git clone <url-репозитория>
   cd <директория-проекта>
   ```

2. Убедитесь, что все необходимые файлы находятся в одной директории:
   - `docker-compose.yml`
   - `init.sql`
   - `schema.sql`
   - `insert_sample_data.sql`
   - `create_views.sql`

3. Запустите систему с помощью одной команды:
   ```
   docker-compose up -d
   ```

   Эта команда запустит первичный и реплицируемый экземпляры PostgreSQL, создаст структуру базы данных, вставит примерные данные и создаст представление для статистики аэропортов.

## Проверка работоспособности

1. Подключитесь к первичной базе данных:
   ```
   docker exec -it postgres_primary psql -U admin -d airline_tickets
   ```

2. Выполните запрос к представлению статистики аэропортов:
   ```sql
   SELECT * FROM airport_traffic;
   ```

   Вы должны увидеть статистику по трафику для каждого аэропорта.

3. Проверьте репликацию, подключившись к реплике и выполнив тот же запрос:
   ```
   docker exec -it postgres_replica psql -U admin -d airline_tickets
   ```
   ```sql
   SELECT * FROM airport_traffic;
   ```

   Результаты должны совпадать с результатами на первичном сервере.

## Структура базы данных

База данных содержит следующие таблицы:
- `airports`: информация об аэропортах
- `aircrafts`: данные о самолетах
- `seats`: информация о местах в самолетах
- `flights`: данные о рейсах
- `bookings`: информация о бронированиях
- `tickets`: данные о билетах
- `ticket_flights`: связь между билетами и рейсами
- `boarding_passes`: информация о посадочных талонах

## Представление `airport_traffic`

Представление `airport_traffic` предоставляет статистику по каждому аэропорту в формате:
```
airport_code | departure_flights_num | departure_psngr_num | arrival_flights_num | arrival_psngr_num
```

Где:
- `airport_code`: код аэропорта
- `departure_flights_num`: количество вылетающих рейсов
- `departure_psngr_num`: количество вылетающих пассажиров
- `arrival_flights_num`: количество прибывающих рейсов
- `arrival_psngr_num`: количество прибывающих пассажиров

## Дополнительная информация

- Первичный сервер PostgreSQL доступен на порту 5432
- Реплика PostgreSQL доступна на порту 5433
- Пользователь базы данных: admin
- Пароль: adminpassword
- Имя базы данных: airline_tickets

## Дополнение
- Особая благодарность этой статье [тык](https://medium.com/@eremeykin/how-to-setup-single-primary-postgresql-replication-with-docker-compose-98c48f233bbf) за вдохновление и избавления от головной боли.
- Синтетические данные были созданы при помощи GPT моделей